---
// src/pages/blog/index.astro
import BaseLayout from '@/layouts/base-layout.astro';
import { getPosts } from '@/lib/ghost';

const posts = await getPosts({ limit: 'all' });

const pageTitle = 'Blog | duchi.click';
const pageDescription = 'Latest articles and thoughts on software development.';
---

<BaseLayout title={pageTitle} description={pageDescription}>
  <main class="container mx-auto px-4 py-12">
    <header class="mb-12">
      <h1 class="text-4xl font-bold mb-4">Blog</h1>
      <p class="text-lg text-base-content/70">{pageDescription}</p>
    </header>

    {
      posts.length === 0 ? (
        <div class="text-center py-12">
          <p class="text-base-content/50">No posts found.</p>
        </div>
      ) : (
        <div class="grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3">
          {posts.map((post) => (
            <a
              href={`/blog/${post.slug}`}
              class="card bg-base-100 shadow-xl transition-shadow duration-300 hover:shadow-2xl"
            >
              <figure class="aspect-video">
                {post.feature_image ? (
                  <img
                    src={post.feature_image}
                    alt={post.title}
                    class="h-full w-full object-cover"
                    loading="lazy"
                  />
                ) : (
                  <div class="flex h-full w-full items-center justify-center bg-base-200">
                    <span class="text-4xl opacity-20">üìù</span>
                  </div>
                )}
              </figure>
              <div class="card-body">
                <div class="mb-2 flex items-center gap-2">
                  {post.primary_tag && (
                    <span class="badge badge-primary badge-sm">{post.primary_tag.name}</span>
                  )}
                  <span class="text-xs text-base-content/50">
                    {new Date(post.published_at).toLocaleDateString('ko-KR', {
                      year: 'numeric',
                      month: 'short',
                      day: 'numeric',
                    })}
                  </span>
                </div>
                <h2 class="card-title text-xl">{post.title}</h2>
                <p class="line-clamp-3 text-sm text-base-content/70">
                  {post.custom_excerpt || post.excerpt}
                </p>
                <div class="card-actions mt-4 justify-end">
                  <span class="link link-hover text-sm text-primary">Read more ‚Üí</span>
                </div>
              </div>
            </a>
          ))}
        </div>
      )
    }
  </main>
</BaseLayout>
