---
// src/pages/blog/[...page].astro
import type { GetStaticPaths, InferGetStaticPropsType } from 'astro';

import ContentListLayout from '@/layouts/content-list-layout.astro';
import { getPosts } from '@/lib/ghost';
import type { CardItem } from '@/types/content';

export const getStaticPaths = (async ({ paginate }) => {
  const PAGE_SIZE = 9;
  const posts = await getPosts({ limit: 'all' });

  const cardItems: CardItem[] = posts.map((post) => ({
    slug: post.slug,
    title: post.title,
    excerpt: post.custom_excerpt || post.excerpt,
    featureImage: post.feature_image,
    publishedAt: post.published_at,
    readingTime: post.reading_time,
    primaryTag: post.primary_tag
      ? { name: post.primary_tag.name, slug: post.primary_tag.slug }
      : undefined,
  }));

  return paginate(cardItems, { pageSize: PAGE_SIZE });
}) satisfies GetStaticPaths;

type Props = InferGetStaticPropsType<typeof getStaticPaths>;

const { page } = Astro.props as Props;

const pageTitle =
  page.currentPage === 1
    ? 'Blog | blog.duchi.click'
    : `Blog - Page ${page.currentPage} | blog.duchi.click`;
const pageDescription = 'Latest articles and thoughts on software development.';
---

<ContentListLayout title={pageTitle} description={pageDescription} page={page} basePath="/blog" />
